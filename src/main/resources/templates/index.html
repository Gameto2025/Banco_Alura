<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Churn â€“ Banco Alura</title>
     meta= http-equiv"refresh" content="0; url= /dashboard.html"
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        h2 { color: #2c3e50; text-align: center; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #666; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        /* BotÃ³n Principal */
        button { width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background: #2980b9; }

        /* Estilo para el botÃ³n del Dashboard */
        .btn-dashboard {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background: transparent;
            color: #7f8c8d;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn-dashboard:hover {
            background: #f8f9fa;
            color: #2c3e50;
            border-color: #2c3e50;
        }

        /* Estilos para el cuadro de resultado */
        #resultado { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; text-align: center; border: 1px solid #ddd; }
        #mensajeRespuesta { margin: 0; font-size: 18px; font-weight: bold; }
        #probabilidad { margin: 5px 0 0; font-size: 16px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Analizador de Clientes Banco Alura</h2>
    
    <div class="form-group">
        <label>Edad del cliente:</label>
        <input type="number" id="edad" placeholder="Ej: 55">
    </div>

    <div class="form-group">
        <label>NÃºmero de productos contratados:</label>
        <input type="number" id="productos" placeholder="Ej: 2">
    </div>

    <div class="form-group">
        <label>Â¿La cuenta estÃ¡ ACTIVA actualmente?</label>
        <select id="activo">
            <option value="1">1 = SÃ­</option>
            <option value="0">0 = No</option>
        </select>
    </div>

    <div class="form-group">
        <label>Seleccione paÃ­s:</label>
        <select id="pais">
            <option value="0">0 = France</option>
            <option value="1">1 = Germany</option>
            <option value="2">2 = Spain</option>
        </select>
    </div>

    <button onclick="realizarPrediccion()">Consultar Churn</button>

    <a href="/dashboard.html" class="btn-dashboard">
        ðŸ“Š Ver Dashboard de Riesgos
    </a>

    <div id="resultado">
        <p id="mensajeRespuesta"></p>
        <p id="probabilidad"></p>
    </div>
</div>

<script>
async function realizarPrediccion() {
    // 1. Capturamos los datos del formulario
    const datos = {
        edad: document.getElementById('edad').value,
        productos: document.getElementById('productos').value,
        activo: document.getElementById('activo').value,
        pais: document.getElementById('pais').value
    };

    console.log("Datos enviados al servidor:", datos);

    try {
        const response = await fetch('https://banco-alura.onrender.com/api/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datos)
        });

        const data = await response.json();
        console.log("Respuesta de Java:", data);

        if (data.score !== undefined) {
            const resultadoDiv = document.getElementById('resultado');
            const mensajeElement = document.getElementById('mensajeRespuesta');
            const probabilidadElement = document.getElementById('probabilidad');

            // OPCIÃ“N 1: Usar el mensaje detallado del backend
            mensajeElement.innerText = data.mensaje || 
                (data.abandona ? "El cliente tiene riesgo de abandono" : "El cliente No tiene riesgo de abandono");
            
            // Muestra la probabilidad
            probabilidadElement.innerText = "Probabilidad: " + (data.probabilidad || (data.score * 100).toFixed(1) + "%");

            // 3. Aplicamos colores segÃºn el riesgo
            if (data.colorRiesgo) {
                resultadoDiv.style.backgroundColor = getColorFondo(data.colorRiesgo);
                resultadoDiv.style.color = data.colorRiesgo;
                resultadoDiv.style.borderColor = data.colorRiesgo;
            } else {
                if (data.abandona) {
                    resultadoDiv.style.backgroundColor = "#ffebee"; // Rojo claro
                    resultadoDiv.style.color = "#c62828";
                    resultadoDiv.style.borderColor = "#ef9a9a";
                } else {
                    resultadoDiv.style.backgroundColor = "#e8f5e9"; // Verde claro
                    resultadoDiv.style.color = "#2e7d32";
                    resultadoDiv.style.borderColor = "#a5d6a7";
                }
            }

            // 4. Mostramos el cuadro
            resultadoDiv.style.display = 'block';

        } else if (data.error) {
            alert("Error: " + data.error);
        }
    } catch (error) {
        console.error("Error en la conexiÃ³n:", error);
        alert("No se pudo conectar con el servidor Java. Â¿EstÃ¡ encendido?");
    }
}

function getColorFondo(colorHex) {
    switch(colorHex) {
        case '#dc3545': return '#ffebee'; // Rojo
        case '#ffc107': return '#fff8e1'; // Amarillo
        case '#28a745': return '#e8f5e9'; // Verde
        case '#17a2b8': return '#e3f2fd'; // Azul
        default: return '#f5f5f5';
    }
}
</script>

</body>
</html>